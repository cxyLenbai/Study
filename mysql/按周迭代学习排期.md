# MySQL 按周迭代学习排期（实战版，16 周）

说明：每周包含目标、实战任务、验收标准与产出物；默认 MySQL 8.0，环境为 Windows + Docker Desktop（可选 WSL2）。

## 第 1 周：安装与基础 SQL
- 目标：安装 MySQL 8.0，熟悉基本 SQL（DDL/DML/DQL）
- 实战任务：创建 `orders`/`order_items`/`inventory` 表；准备 100 万行测试数据
- 验收：基础查询与写入正确；数据导入脚本稳定
- 产出物：初始化脚本、数据生成器（PowerShell 或 Python）

## 第 2 周：模型与约束
- 目标：范式与反范式，主键/唯一/外键/检查约束
- 实战任务：订单模型设计（含状态/金额/审计字段），生成列与 JSON 字段实践
- 验收：约束与一致性到位；典型查询可覆盖索引
- 产出物：模型设计文档与迁移脚本

## 第 3 周：索引与 EXPLAIN
- 目标：联合索引/覆盖索引/前缀与不可见索引
- 实战任务：为核心查询设计索引；`EXPLAIN` 与 `optimizer trace` 分析
- 验收：核心查询 P95 `<200ms`；回表次数下降，`rows`/`filtered` 指标优化
- 产出物：索引策略清单与对比报告

## 第 4 周：事务与隔离
- 目标：避免脏读/不可重复读/幻读，控制并发
- 实战任务：实现下单事务（扣库存/写订单）；悲观锁 vs 乐观锁对比
- 验收：并发 1e5 下单仿真无超卖；死锁自动重试成功率 `>99%`
- 产出物：事务边界与重试策略文档、仿真脚本

## 第 5 周：锁与竞争
- 目标：InnoDB 锁类型与范围、锁监控与排障
- 实战任务：模拟热点行/间隙锁；分析 `information_schema` 与 Performance Schema 锁事件
- 验收：定位并化解锁竞争；死锁率 `<0.1%`
- 产出物：锁分析报告与治理方案

## 第 6 周：查询优化与重写
- 目标：谓词下推、索引选择、JOIN 顺序、子查询改写
- 实战任务：重写慢查询；建立直方图与统计信息
- 验收：慢查询阈值（`>1s`）清零；P95 显著下降
- 产出物：慢查询清单、`pt-query-digest` 报告

## 第 7 周：配置与性能调优
- 目标：缓冲池/Redo/Flush/IO 调优，连接池参数
- 实战任务：调参对比（`innodb_buffer_pool_size`/`redo size`/`flush_log_at_trx_commit`）
- 验收：稳态 QPS `>3000`、写入 P95 `<80ms`（本机），资源占用在阈值内
- 产出物：基准脚本与调优报告

## 第 8 周：分区与大表治理
- 目标：分区表设计、冷热数据管理、归档策略
- 实战任务：`RANGE` 分区订单表；月度归档与裁剪
- 验收：分区裁剪有效；批量归档成本可接受（无长事务阻塞）
- 产出物：分区与归档手册、作业脚本

## 第 9 周：复制与一致性
- 目标：主从复制、半同步、GTID
- 实战任务：搭建 1 主 2 从；复制延迟监控与告警
- 验收：复制延迟 `<500ms`；一致性校验通过（`pt-table-checksum`）
- 产出物：集群搭建与监控脚本、校验报告

## 第 10 周：故障切换与读写分离
- 目标：Orchestrator + ProxySQL（或自选）
- 实战任务：配置读写分离；演练主库宕机故障切换
- 验收：切换 `<30s`；业务无感或最小错误；只读库无数据漂移
- 产出物：故障演练剧本与结果记录

## 第 11 周：备份与恢复（全量/增量/PITR）
- 目标：XtraBackup、binlog 定位与恢复
- 实战任务：定时全量 + 小时级增量；PITR 到指定时间点
- 验收：RTO `<15min`、RPO `<1min`；恢复校验与演练通过
- 产出物：备份/恢复脚本、演练记录

## 第 12 周：监控与告警（PMM/PS/sys）
- 目标：慢查询、锁、复制延迟、资源告警
- 实战任务：接入 PMM；自定义面板与阈值告警
- 验收：关键告警有效且去重；面板覆盖核心指标
- 产出物：Grafana 面板 JSON、告警规则与手册

## 第 13 周：安全与合规
- 目标：用户/角色/权限、TLS/SSL、审计
- 实战任务：最小权限清单、mTLS、审计日志落地与轮转
- 验收：安全基线通过；敏感操作可追溯
- 产出物：安全与合规清单、自动化脚本

## 第 14 周：在线变更与发布
- 目标：在线 DDL、pt-osc、灰度与回滚
- 实战任务：大表加索引与字段变更；发布回滚演练
- 验收：无阻塞、业务无感；回滚剧本有效
- 产出物：变更手册与演练记录

## 第 15 周：数据生命周期与成本
- 目标：归档/压缩/保留策略、冷热分离
- 实战任务：历史数据归档与读路径设计；存储成本评估
- 验收：查询性能稳定；成本下降与可视化
- 产出物：生命周期治理方案与评估报告

## 第 16 周：总集成与复盘
- 目标：整合一致性服务、HA 与备份、监控与安全
- 实战任务：端到端演示（故障注入 + 恢复）、容量与成本陈述
- 验收：所有指标达标；技术陈述与迁移建议完整
- 产出物：最终 Demo、复盘文档与剧本

## 每周交付模板（建议）
- 代码与脚本：`mysql-expert/<module>` 每周新增或完善
- 文档：`docs/week-XX.md`（目标/任务/产出/指标/复盘）
- 看板：`monitoring/` 面板与告警导出
- 压测：`benchmarks/week-XX/` 脚本与报告