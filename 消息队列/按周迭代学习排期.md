# 消息队列按周迭代学习排期（实战版，16 周）

说明：每周包含目标、实战任务、验收标准与产出物；所有任务默认以 Kafka 为主、RabbitMQ 互补，环境为 Windows（可用 Docker Desktop）。

## 第 1 周：环境搭建与最小可运行
- 目标：本地启动 Kafka/RabbitMQ，完成生产/消费 Hello World
- 实战任务：创建 `topic: orders_v1` 与 `queue: orders_q`；编写 Producer/Consumer（Java）
- 验收：发送 1 万条消息，消费完成且无丢失；基础指标可见（吞吐/延迟）
- 产出物：`spring-boot-mq-demo` 初始仓、启动脚本、README

## 第 2 周：事件建模与序列化
- 目标：统一事件 Schema 与序列化方式
- 实战任务：定义 `OrderCreated` 事件（JSON/Avro），加入 `traceId`、`eventId`、`occurredAt`
- 验收：生产端与消费端均校验 Schema；落盘日志可关联 Trace
- 产出物：`common-event` 模块、Schema 约束与示例

## 第 3 周：Spring 集成与幂等消费
- 目标：整合 `Spring for Apache Kafka`/`RabbitTemplate`
- 实战任务：消费者实现幂等（幂等键+去重表/缓存）；错误处理回调
- 验收：重复投递情况下，业务只执行一次；端到端日志可追踪
- 产出物：`consumer` 模块幂等实现、测试用例

## 第 4 周：重试与 DLQ 治理
- 目标：构建指数退避重试与死信队列治理
- 实战任务：失败分类（业务/暂时性/不可恢复），自动进入重试或 DLQ；治理看板草图
- 验收：三类故障处理闭环；回补流程可演示
- 产出物：`retry-governance` 模块、DLQ 处理器、演示脚本

## 第 5 周：消费组与位移管理
- 目标：掌握手动位移与再均衡
- 实战任务：手动提交 offset；实现再均衡监听与会话管理策略
- 验收：扩缩消费者无重复/无丢失；再均衡期间系统平稳
- 产出物：位移管理策略文档、对比实验数据

## 第 6 周：可观测性与告警
- 目标：接入 JMX -> Prometheus -> Grafana
- 实战任务：搭建指标面板（吞吐/延迟/Lag/错误率/再均衡事件）；配置告警阈值
- 验收：指标可用；Lag 超阈值触发告警
- 产出物：Grafana 面板 JSON、告警规则 YAML

## 第 7 周：性能与调优
- 目标：掌握关键参数与瓶颈分析
- 实战任务：对比 `acks/linger.ms/batch.size/压缩/分区数`；写基准报告
- 验收：给出 TPS 与 P99 延迟提升曲线；定位性能瓶颈
- 产出物：压测脚本与报告、调参清单

## 第 8 周：架构模式与落地
- 目标：延迟队列、Outbox、Saga/补偿原型
- 实战任务：实现延迟投递（RocketMQ/Redis Streams）；Outbox + Debezium CDC 原型
- 验收：延迟触发准时、无重复；Outbox E2E 投递可靠
- 产出物：`delay-service` 与 `outbox-cdc` 原型代码

## 第 9 周：项目一（订单事件总线）- 建模与生产端
- 目标：完成领域事件建模与生产端服务
- 实战任务：分区键策略（用户维度键内有序）；批量与压缩优化
- 验收：端到端吞吐 `>50k msg/s`（本机），P99 延迟 `<200ms`
- 产出物：`order-producer` 服务、基准测试报告

## 第 10 周：项目一（订单事件总线）- 消费与观测
- 目标：完善消费端、幂等与错误治理
- 实战任务：故障注入（网络抖动/格式异常/宕机）；Lag 与错误率告警验证
- 验收：零重复/零丢失；告警与恢复流程有效
- 产出物：`order-consumer` 服务、故障演练记录

## 第 11 周：项目二（重试与 DLQ 治理）- 设计与实现
- 目标：抽象横切治理层
- 实战任务：失败原因归类、自动回补策略、人工工单流对接
- 验收：治理服务可复用；回补成功率 `>99%`
- 产出物：`retry-governance` SDK、治理看板

## 第 12 周：项目二（重试与 DLQ 治理）- 压测与稳定性
- 目标：容量规划与极端场景恢复
- 实战任务：堆积压力测试、反压/限流策略；再均衡与扩缩容回归
- 验收：高压下无雪崩；恢复时间与数据一致性达标
- 产出物：容量报告与运行手册

## 第 13 周：项目三（延迟任务服务）- 架构与原型
- 目标：分层时间轮、去重与并发合并
- 实战任务：实现触发器与业务回调、失败重排与兜底
- 验收：百万级触发正确率 `>99.9%`，准时率 P99 `<1s`
- 产出物：`delay-service` 核心模块与测试

## 第 14 周：项目三（延迟任务服务）- 对比评估与优化
- 目标：与 Quartz/DB 定时任务对比
- 实战任务：稳定性与成本评估、边界场景回归（宕机/网络抖动）
- 验收：取舍清晰，优化建议可落地
- 产出物：对比报告与优化清单

## 第 15 周：安全与合规
- 目标：ACL、SASL/TLS、审计与密钥管理
- 实战任务：配置证书与权限最小化；审计日志落地与轮转
- 验收：通过安全基线检查；敏感操作可追溯
- 产出物：安全基线清单、自动化脚本

## 第 16 周：迁移与云托管对比
- 目标：RocketMQ/Pulsar 或云托管方案（MSK/Event Hubs）
- 实战任务：复刻项目一于云托管；成本与运维对比
- 验收：能做技术选型陈述与迁移建议
- 产出物：迁移指南与成本评估

## 每周交付模板建议（落地）
- 代码：`spring-boot-mq-demo/<module>`；每周新增或完善模块
- 文档：`docs/week-XX.md`（目标/任务/产出/指标/复盘）
- 看板：`monitoring/grafana-boards/` 导出 JSON 与截图
- 压测：`benchmarks/week-XX/` 脚本与报告