# 消息队列从入门到实战专家学习路径（实战版）

## 学习成果（可量化）
- 能在本机与容器中部署 Kafka/RabbitMQ，并完成生产/消费端到端验证。
- 交付 3 个可运行项目：订单事件总线、智能重试与 DLQ 治理、延迟任务服务。
- 达成指标门槛：单主题 `>50k msg/s` 吞吐（本机）、消费端 P99 延迟 `<200ms`、Lag 稳定在可控阈值内、错误率 `<0.1%`。
- 完成可靠性策略：至少一次/恰好一次语义的取舍与实现、幂等键与去重策略、顺序性保障与乱序治理。
- 建立监控与告警：Prometheus+Grafana 指标面板（吞吐/延迟/Lag/错误率/再均衡事件），关键阈值告警生效。
- 安全与合规：SASL/TLS、ACL 最小权限、审计日志与密钥管理清单。

## 里程碑项目（含验收标准）
- 订单事件总线（Kafka）
  - 事件建模：定义 Avro/JSON Schema，分区键策略确保键内有序。
  - 生产/消费：Spring Boot 集成、批量与压缩、手动位移提交。
  - 一致性：Outbox + Debezium CDC，实现跨服务可靠投递。
  - 验收：10 万消息压测，重复/丢失为 0，可观测面板齐备，E2E Trace 可串联。
- 智能重试与 DLQ 治理（Kafka/RabbitMQ）
  - 重试策略：固定/指数退避、最大重试次数、幂等校验。
  - DLQ 治理：失败原因归类、自动回补与人工工单流，治理看板。
  - 验收：三类故障（业务异常/暂时性错误/不可恢复）处理闭环，回补成功率 `>99%`。
- 延迟任务服务（RocketMQ/Redis Streams）
  - 架构：分层时间轮/桶式延迟、去重与并发合并、防雪崩策略。
  - 集成：触发器与业务回调、失败重排与兜底。
  - 验收：百万级定时触发正确率 `>99.9%`，准时率 P99 `<1s`，无重复触发。

## 核心技能清单（动手重点）
- 可靠性：At-least-once/Exactly-once、生产端幂等（`enable.idempotence`）、消费者幂等键与去重表。
- 顺序性：键内有序/跨分区乱序、事务与幂等协同、消息重排策略。
- 位移与再均衡：手动提交、`max.poll.interval.ms`、会话管理、再均衡监听与稳定性设计。
- 性能调优：`acks`、`linger.ms`、`batch.size`、压缩算法、分区与并行度、网络与磁盘瓶颈分析。
- 可观测：JMX -> Prometheus、Lag 计算、慢消费识别、分区热点与堆积治理、Trace 贯通。
- 安全：SASL/OAuth、TLS 证书、ACL、审计与数据治理、密钥轮换流程。

## 环境与工具
- 运行环境：Windows（Docker Desktop 或二进制安装）、WSL 可选。
- 监控：Prometheus、Grafana、Micrometer、JMX Exporter。
- 压测：k6/JMeter/自研压测器（Java Producer/Consumer 基准）。
- 开发框架：Spring Boot、Spring for Apache Kafka、RabbitTemplate、Spring Cloud Stream、Debezium。

## 交付物与目录建议
- 代码仓：`spring-boot-mq-demo/`（模块：`producer/consumer/common/monitoring`）
- 文档：`docs/`（设计说明、基准测试报告、运营与告警手册、安全基线与合规清单）
- 看板：Grafana 导出 JSON、告警规则 YAML
- 运维脚本：主题/队列管理、分区与副本调整、容量规划脚本

## 验收与评分标准
- 指标达标：吞吐/延迟/错误率/Lag/稳定性 达到门槛
- 故障演练：网络抖动、消费者宕机、磁盘慢、消息格式异常，均能恢复且无数据丢失
- 设计陈述：能清晰阐述选型、取舍与应对方案，并给出迁移与成本评估